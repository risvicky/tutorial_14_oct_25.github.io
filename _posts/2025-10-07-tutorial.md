---
title: "Ionic "
date: 2025-10-07
author: "Risnita Vicky Listyarini"
---

The objective of this tutorial is to perform molecular dynamics simulation using open-source software GROMACS to study the system consist of water with sodium (Na<sup>+</sup>) and cloride (NO<sub>3</sub><sup>-</sup>) ions.

The tutorial will guide you through the steps of setting up the simulation, adding species to the system and solvating it with water.
It will also introduce key points in MD simulation e.g. energy minimisation,thermostating, and both *NVT* and *NPT* equilibration steps.

## Molecular Dynamics Simulation Steps
The following steps will be covered in this tutorial:
1. **Preparation of the System**: Setting up the initial configuration of NaNO<sub>3</sub> in a water box.
2. **Setting Up the Simulation Parameters**: Defining the force field and simulation parameters.
3. **Energy Minimization**: Performing energy minimisation to relax the system.
4. **Equilibration**: Running equilibration steps under *NVT* and *NPT* ensembles.
5. **Production Run**: Conducting the main simulation to collect data for analysis.
6. **Analysis**: Analysing the results to understand the solvation of NaNO<sub>3</sub> in water.

## Setting Up GROMACS environment
Make sure you can run GROMACS commands in your terminal. Load GROMACS by typing the following command in your terminal:
   ```bash
   module load gromacs/intel-2022.2/2022.1-single
    gmx --version
    gmx
   ```
   If this result appears,
   ```bash
    gmx
    -bash: gmx: command not found
   ```
   depending to the access node that your account has, for teaching node
   ```bash
    source /usr/local/gromacs/bin/GMXRC
    gmx
   ```
   To get more information about GROMACS installation and user guide, please visit [GROMACS website](https://manual.gromacs.org/current/install-guide/index.html).[1]

### Setting Up Molecular Visualisation Software
To visualise the molecular structure and simulation results, we can use program like Visual Molecular Dynamics (VMD) or PyMol.
We will use VMD program. [VMD](https://www.ks.uiuc.edu/Development/Download/download.cgi?PackageName=VMD) is available to non-commercial users under a distribution-specific license which permits both use of the program and modification of its source code, at no charge. You just have to register your email to download the program.

To load the module,
   ```bash
    module load vmd/1.9.4
    vmd
   ```
If you are using ThinLinc, you need to do,
   ```bash
    module load vmd/1.9.4
    vglrun vmd
   ```

## Preparation of the System
Let us create a new directory for MD simulation files.
   ```bash
   mkdir nano3_solution
   cd nano3_solution
   ```
We will make an empty box by creating an empty file called `empty.gro`.
   ```bash
   touch empty.gro
   nedit empty.gro
   ```
`touch` command is used to create a new empty file, while `nedit` command opens a text editor with a standard GUI (graphical user interface) in Linux.
You can also open and edit the file using your favourite text editor in Linux.

Then, we will create a box with a size of 3 nm x 3 nm x 3 nm by copying and pasting the following lines into `empty.gro`.
   ```
    Cubic box
    0
    3.00000   3.00000   3.00000
   ```
The first line, `Cubic box`, is a comment line; the second line, `0`, indicates that there are no atoms in the box; and the third line specifies the dimensions of the box in nanometers, 10 nm in each direction (x, y, z). This ***.gro*** is written in [Gromos87](https://manual.gromacs.org/archive/5.0.4/online/gro.html) format. 

Next, we will add NO<sub>3</sub><sup>-</sup> ions to the box. Within the same folder as `empty.gro`, make a new file called `no3.gro` and copy the following lines into it.
   ```
NO3 ion
    4
    1NO3    N1    1   0.000   0.000   0.000
    1NO3    O1    2   0.120   0.120   0.000
    1NO3    O2    3  -0.120   0.120   0.000
    1NO3    O3    4   0.000  -0.140   0.000
   1.00000   1.00000   1.00000
   ```
It contains 4 atoms named `N1`, `O1`, `O2`, and `O3`all grouped under the residue name `NO3`. 

Using the `gmx insert-molecules` command to add 10 NO<sub>3</sub><sup>-</sup> ions to the empty box, type the following command in your terminal:

   ```bash
   gmx insert-molecules -ci no3.gro -f empty.gro -o conf.gro -nmol 10 -radius 0.5
   ```
The `insert-molecule` command inserts molecules into a simulation box. The `-ci` flag specifies the input file containing the molecule to be inserted, which is `no3.gro` in this case. The `-f` flag indicates the input file for the box, which is `empty.gro`. The `-o` flag specifies the output file name, which will be `conf.gro`, containing the new configuration with the inserted ions. The `-nmol` flag indicates the number of ions to insert (10 NO<sub>3</sub><sup>-</sup> ions). The `-radius` flag sets the minimum distance between inserted molecules to avoid overlaps (set to 0.5 nm) 
See documentation of [insert-molecule](https://manual.gromacs.org/2025.1/onlinehelp/gmx-insert-molecules.html) command for more information. 

If the insertions were sucessful, the output printed in the terminal should look like this.
```
Added 10 molecules (out of 10 requested)
Writing generated configuration to conf.gro
```

The generated **conf.gro** should contains 40 atoms corresponding to 10 ions.
```
Cubic box
   40
    1NO3     N1    1   0.714   1.584   2.324
    1NO3     O1    2   0.848   1.578   2.428
    1NO3     O2    3   0.748   1.747   2.289
    1NO3     O3    4   0.616   1.493   2.283
    (...)
3.00000   3.00000   3.00000
```
The explanation of each row:
- the residue ID, with all 4 atoms from the same ion NO<sub>3</sub><sup>-</sup> sharing the same residue ID
- the residue name (NO3)
- the atom name (N1, O1, O2, O3) 
- the atom ID (1 to 40)
- the atom position (*x*, *y*, *z* coordinates in nm)

Make a new file called `na.gro` and copy the following lines into it.
   ```
Na+ ion
1
    1   Na   Na1   1   0.000   1.000   0.000
   1.00000   1.00000   1.00000
   ```

## üß© Exercise

<div class="exercise-box">
  <div class="exercise-header">Exercise</div>
  <p>
    Use the `insert-molecules` command to add 10 Na<sup>+</sup> to the same `conf.gro` file with radius of 0.5 nm from each other.
  </p>

  <details class="solution-box">
    <summary>üëÅÔ∏è Solution</summary>
    <pre><code>gmx insert-molecules -ci na.gro -f conf.gro -o conf.gro -nmol 10 -radius 0.5</code></pre>
  </details>
</div>

<style>
.exercise-box {
  border: 2px solid #f0c27b;
  background-color: #fff8e1;
  border-radius: 10px;
  padding: 16px;
  margin: 20px 0;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.exercise-header {
  background-color: #f3cd88;
  color: #4a3a1f;
  font-weight: bold;
  padding: 6px 10px;
  border-radius: 6px;
  margin-bottom: 10px;
  font-size: 1.1em;
}

.solution-box summary {
  background-color: #f0ede3;
  padding: 8px 12px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}

.solution-box[open] summary {
  background-color: #e2dcc4;
}

.solution-box pre {
  background-color: #f6f4eb;
  padding: 10px;
  border-radius: 6px;
  margin-top: 8px;
  overflow-x: auto;
}
</style>

Finally, we will add H<sub>2</sub>O molecules to the box.
Download the [h2o.gro](/file/h2o.gro) template for H<sub>2</sub>O molecule and save it in the same folder.

## üß© Exercise

<div class="exercise-box">
  <div class="exercise-header">Exercise</div>
  <p>
    Use the `insert-molecules` command to add 800 H<sub>2</sub>O molecule to the same `conf.gro` file from previous step with radius of 0.14 nm from each other.
  </p>

  <details class="solution-box">
    <summary>üëÅÔ∏è Solution</summary>
    <pre><code>gmx insert-molecules -ci h2o.gro -f conf.gro -o conf.gro -nmol 800 -radius 0.14</code></pre>
  </details>
</div>

<style>
.exercise-box {
  border: 2px solid #f0c27b;
  background-color: #fff8e1;
  border-radius: 10px;
  padding: 16px;
  margin: 20px 0;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.exercise-header {
  background-color: #f3cd88;
  color: #4a3a1f;
  font-weight: bold;
  padding: 6px 10px;
  border-radius: 6px;
  margin-bottom: 10px;
  font-size: 1.1em;
}

.solution-box summary {
  background-color: #f0ede3;
  padding: 8px 12px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}

.solution-box[open] summary {
  background-color: #e2dcc4;
}

.solution-box pre {
  background-color: #f6f4eb;
  padding: 10px;
  border-radius: 6px;
  margin-top: 8px;
  overflow-x: auto;
}
</style>

The final **conf.gro** file contains:

References:
1. GROMACS User Manual, https://manual.gromacs.org/current/install-guide/index.html
2. 
3. 